!function(e){"use strict";e((function(){e(document).on("click","#rtcl-store-sub-menu a",(function(r){r.preventDefault();var t=e(this),a=t.data("target");a&&(e("#rtcl-store-content-wrap").find(".rtcl-store-content").hide(),e("#rtcl-store-"+a+"-content").show(),t.parents("ul").find("li").removeClass("active"),t.parent("li").addClass("active"))})).on("click",".rtcl-store-invite-manager",(function(r){var t=e('<div class="rtcl-invite-manager-wrap"><input type="email" id="rtcl-manager-email" class="rtcl-form-control" autocomplete="off" placeholder="Email address"> <span class="rtcl-btn rtcl-btn-success add-manager">Add</span></div>'),a=new RtclModal({footer:!1,wrapClass:"rtcl-store-im-popup no-heading"});a.addModal().content(t);var n=t.find("#rtcl-manager-email");n.on("change keyup",(function(){var e=n.val();/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(e)&&e?n.removeClass("is-invalid"):n.addClass("is-invalid")})),t.find(".add-manager").on("click",(function(){var r=n.val();/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(r)?e.ajax({url:rtcl_store.ajaxurl,type:"POST",data:{email:r,__rtcl_wpnonce:rtcl_store.__rtcl_wpnonce,action:"rtcl_ajax_store_send_manager_invitation_by_email"},beforeSend:function(){a.addLoading(),e(".rtcl-store-pp-error").remove()},success:function(r){a.removeLoading(),r.success?(a.removeModel(),toastr.success(r.data.message),e("#rtcl-store-managers").append(r.data.html)):a.appendContent('<div class="rtcl-store-pp-error">'+r.data+"</div>")},error:function(e){console.log(e),a.removeLoading(),a.content()}}):n.addClass("is-invalid")}))})).on("click",".rtcl-store-manager-remove",(function(){var r=e(this),t=parseInt(r.data("manager_user_id"),10)||0,a=r.parents(".rtcl-store-manager");t&&confirm(rtcl_store.confirm_text)&&e.ajax({url:rtcl_store.ajaxurl,type:"POST",data:{manager_user_id:t,__rtcl_wpnonce:rtcl_store.__rtcl_wpnonce,action:"rtcl_ajax_store_remove_manager_by_user_id"},beforeSend:function(){a.rtclBlock()},success:function(e){a.rtclUnblock(),e.success?(e.data.manager_user_id===t&&a.remove(),toastr.success(e.data.message)):toastr.error(e.data)},error:function(e){a.rtclUnblock(),toastr.error(rtcl_store.server_error)}})})),e(".rtcl-store-banner-wrap .rtcl-media-action").on("click","span.remove",(function(){var r=e(this),t=r.parents(".rtcl-store-banner"),a=e(".banner",t),n={action:"rtcl_ajax_store_banner_delete",__rtcl_wpnonce:rtcl_store.__rtcl_wpnonce};confirm(rtcl_store.confirm_text)&&e.ajax({url:rtcl_store.ajaxurl,data:n,type:"POST",beforeSend:function(){e("<span class='rtcl-icon-spinner animate-spin'></span>").insertAfter(r)},success:function(e){r.next(".rtcl-icon-spinner").remove(),e.error||(t.addClass("no-banner"),t.removeClass("has-banner"),a.html(""))},error:function(e,t,a){r.next(".rtcl-icon-spinner").remove(),console.log("error")}})})),e(".rtcl-store-banner-wrap .rtcl-media-action").on("click","span.add",(function(){var r=e(this),t=e("<input type='file' style='position:absolute;left:-9999px' />");e("body").append(t),navigator.userAgent.match(/MSIE ([0-9]+)\./)?t.trigger("change"):t.trigger("click"),t.on("change",(function(){var t=e(this),a=r.parents(".rtcl-store-banner"),n=e(".banner",a),s=new FormData,o=t[0].files[0],c=rtcl_store.image_allowed_type.map((function(e){return"image/"+e})),l=parseInt(rtcl_store.max_image_size);-1!==e.inArray(o.type,c)?o.size<=l?(s.append("banner",o),s.append("action","rtcl_ajax_store_banner_upload"),e.ajax({url:rtcl_store.ajaxurl,data:s,cache:!1,contentType:!1,processData:!1,type:"POST",beforeSend:function(){a.find(".rtcl-media-action").append("<span class='rtcl-icon-spinner animate-spin'></span>")},success:function(e){a.find(".rtcl-icon-spinner").remove(),e.error||(a.addClass("has-banner"),a.removeClass("no-banner"),n.html("<img class='rtcl-thumbnail' src='"+e.data.src+"'/>"))},error:function(e,r,t){a.find(".rtcl-icon-spinner").remove(),console.log("error")}})):alert(rtcl_store.error_image_size):alert(rtcl_store.error_image_extension)}))})),e(".rtcl-store-logo-wrap .rtcl-media-action").on("click","span.remove",(function(){var r=e(this).parents(".rtcl-store-logo-wrap"),t=e(".logo",r),a={action:"rtcl_ajax_store_logo_delete",__rtcl_wpnonce:rtcl_store.__rtcl_wpnonce};confirm(rtcl_store.confirm_text)&&e.ajax({url:rtcl_store.ajaxurl,data:a,type:"POST",beforeSend:function(){r.find(".rtcl-media-action").append("<span class='rtcl-icon-spinner animate-spin'></span>")},success:function(e){r.find(".rtcl-icon-spinner").remove(),e.error||(r.find(".rtcl-store-logo").removeClass("has-logo"),r.find(".rtcl-store-logo").addClass("no-logo"),t.html(""))},error:function(e,t,a){r.find(".rtcl-icon-spinner").remove(),console.log("error")}})})),e(".rtcl-store-logo-wrap .rtcl-media-action").on("click","span.add",(function(){var r=e(this),t=e("<input type='file' style='position:absolute;left:-9999px' />");e("body").append(t),navigator.userAgent.match(/MSIE ([0-9]+)\./)?t.trigger("change"):t.trigger("click"),t.on("change",(function(){var t=e(this),a=r.parents(".rtcl-store-logo-wrap"),n=e(".logo",a),s=new FormData,o=t[0].files[0],c=rtcl_store.image_allowed_type.map((function(e){return"image/"+e})),l=parseInt(rtcl_store.max_image_size);-1!==e.inArray(o.type,c)?o.size<=l?(s.append("logo",o),s.append("action","rtcl_ajax_store_logo_upload"),e.ajax({url:rtcl_store.ajaxurl,data:s,cache:!1,contentType:!1,processData:!1,type:"POST",beforeSend:function(){a.find(".rtcl-media-action").append("<span class='rtcl-icon-spinner animate-spin'></span>")},success:function(e){a.find(".rtcl-icon-spinner").remove(),e.error||(a.find(".rtcl-store-logo").addClass("has-logo"),a.find(".rtcl-store-logo").removeClass("no-logo"),n.html("<img class='rtcl-thumbnail' src='"+e.data.src+"'/>"))},error:function(e,r,t){a.find(".rtcl-icon-spinner").remove(),console.log("error")}})):alert(rtcl_store.error_image_size):alert(rtcl_store.error_image_extension)}))})),e("#oh-type-wrap").on("change","input[name='meta[oh_type]']",(function(){"selected"===e(this).val()?e("#oh-list").removeClass("rtcl-hide"):e("#oh-list").addClass("rtcl-hide")})),e("#rtcl-store-category").on("change",(function(){var r=e(this),t=r.val(),a=e("<div class='alert rtcl-response'></div>"),n=r.parents("#rtcl-store-category-wrap"),s=e("#rtcl-store-sub-category-holder"),o=e("#rtcl-store-sub-cat-row"),c={action:"rtcl_store_get_child_category",term_id:t};t?e.ajax({url:rtcl_store.ajaxurl,data:c,type:"POST",dataType:"json",beforeSend:function(){e("<span class='rtcl-icon-spinner animate-spin'></span>").insertAfter(r),o.addClass("rtcl-hide"),n.find(".alert.rtcl-response").remove()},success:function(t){if(r.next(".rtcl-icon-spinner").remove(),t.success)t.child_cats?(s.html(e('<select name="store-sub-cat[0]" class="form-control" required />').append(t.child_cats)),o.removeClass("rtcl-hide")):(s.html(""),o.addClass("rtcl-hide"));else if(o.addClass("rtcl-hide"),t.message.length){var c="";t.message.map((function(e){c+="<p>"+e+"</p>"})),c&&a.removeClass("alert-success").addClass("alert-danger").html(c).appendTo(n)}},error:function(e){r.next(".rtcl-icon-spinner").remove(),a.removeClass("alert-success").addClass("alert-danger").html(e.responseText).appendTo(n)}}):(s.html(""),o.addClass("rtcl-hide"))})),e(document).on("change","#rtcl-store-sub-category-holder select",(function(){var r=e(this),t=r.parents("#rtcl-store-sub-category-holder"),a=e(this).val(),n=e("<div class='alert rtcl-response'></div>"),s={action:"rtcl_store_get_child_category",term_id:a};a?e.ajax({url:rtcl_store.ajaxurl,data:s,type:"POST",dataType:"json",beforeSend:function(){e("<span class='rtcl-icon-spinner animate-spin'></span>").insertAfter(r),t.find(".alert.rtcl-response").remove(),r.nextAll("select").remove()},success:function(a){if(t.find(".rtcl-icon-spinner").remove(),a.success){if(a.child_cats)t.append(e('<select class="form-control" required />').append(a.child_cats));else if(a.message.length){var s="";a.message.map((function(e){s+="<p>"+e+"</p>"})),s&&n.removeClass("alert-success").addClass("alert-danger").html(s).appendTo(t)}}else if(r.nextAll("select").remove(),a.message.length){var o="";a.message.map((function(e){o+="<p>"+e+"</p>"})),o&&n.removeClass("alert-success").addClass("alert-danger").html(o).appendTo(t)}},error:function(e){t.find(".rtcl-icon-spinner").remove(),n.removeClass("alert-success").addClass("alert-danger").html(e.responseText).appendTo(t)}}):r.nextAll("select").remove()})),e(document).on("change",".rtcl-store-category-wrap select",(function(){var r=e(this).parents(".rtcl-store-category-wrap"),t=e(this).val();t?r.find("#rtcl-store-cat-id").val(t):r.find("#rtcl-store-cat-id").val("")})),e(".open-hour").timepicker(rtcl_store.store_time_options).on("show.timepicker",(function(r){e("body").addClass("rtcl")})).on("hide.timepicker",(function(r){e("body").removeClass("rtcl")})),e(".close-hour").timepicker(rtcl_store.store_time_options).on("show.timepicker",(function(r){e("body").addClass("rtcl")})).on("hide.timepicker",(function(r){e("body").removeClass("rtcl")})),e(".rtcl-self-rm-store-manager").on("click",(function(r){if(r.preventDefault(),confirm(rtcl_store.confirm_text)){var t=e(this).parent();e.ajax({url:rtcl_store.ajaxurl,type:"POST",data:{__rtcl_wpnonce:rtcl_store.__rtcl_wpnonce,action:"rtcl_ajax_store_self_rm_store_manager"},beforeSend:function(){t.rtclBlock()},success:function(e){t.rtclUnblock(),e.success?(toastr.success(e.data.message),t.remove()):toastr.error(rtcl_store.data)},error:function(e){console.log(e),t.rtclUnblock(),toastr.error(rtcl_store.server_error)}})}}))})),e.fn.validate&&(e.validator.setDefaults({rules:{seltype:"required"},errorElement:"div",errorClass:"with-errors",errorPlacement:function(e,r){e.addClass("help-block").removeClass("error"),"checkbox"===r.prop("type")||"radio"===r.prop("type")?e.insertAfter(r.parents(".rtcl-check-list")):e.insertAfter(r)},highlight:function(r,t,a){e(r).parents(".form-group").addClass("has-error has-danger").removeClass("has-success")},unhighlight:function(r,t,a){e(r).parents(".form-group").addClass("has-success").removeClass("has-error has-danger")}}),e("#rtcl-store-settings").validate({submitHandler:function(r){var t=e(r),a=t.find("input[type=submit]"),n=t.parent().find(".rtcl-response"),s=e("<div class='alert'></div>"),o=new FormData(r);return o.append("action","rtcl_update_store_data"),o.append("__rtcl_wpnonce",rtcl_store.__rtcl_wpnonce),e.ajax({url:rtcl_store.ajaxurl,data:o,type:"POST",cache:!1,contentType:!1,processData:!1,beforeSend:function(){t.rtclBlock(),t.addClass("rtcl-loading"),a.prop("disabled",!0),n.html(""),e('<span class="rtcl-icon-spinner animate-spin"></span>').insertAfter(a)},success:function(e){t.rtclUnblock(),a.prop("disabled",!1).next(".rtcl-icon-spinner").remove(),t.removeClass("rtcl-loading"),e.error?s.removeClass("alert-success").addClass("alert-danger").html(e.message).appendTo(n):(s.removeClass("alert-danger").addClass("alert-success").html(e.message).appendTo(n),setTimeout((function(){n.html("")}),1e3))},error:function(e){console.log(e),t.rtclUnblock(),s.removeClass("alert-success").addClass("alert-danger").html(e.responseText).appendTo(n),a.prop("disabled",!1).next(".rtcl-icon-spinner").remove(),t.removeClass("rtcl-loading")}}),!1}}))}(jQuery);