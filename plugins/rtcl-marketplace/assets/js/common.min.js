var frame;!function(e){e(document).ready((function(){function t(t,l){function a(a){e(t).is(":checked")?e(l).slideDown():a?e(l).hide():e(l).slideUp()}a(!0),e(t).change((function(){a()}))}e("#rtcl-marketplace-download").sortable({axis:"y",handle:".rtcl-sort-download",items:"tr",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65}),e("body").on("click","#addRowButton",(function(t){t.preventDefault();var l='\n            <tr>\n                <td class="rtcl-sort-download">â˜°</td>\n                <td class="file_name" width="30%">\n                    <input type="text" class="input_text" placeholder="File name" name="_rtcl_file_names[]" value="" required/>\n                </td>\n                <td class="file_url">\n                    <input type="text" class="input_text file_url" placeholder="http://" name="_rtcl_file_urls[]" value="" required/>\n                </td>\n                <td class="file_url_choose" width="1%"><a href="#" class="button upload_file_button">Choose file</a><input class="upload-file-button" type="file" name="rtcl_marketplace_upload_file" accept="'.concat(rtclMarketPlace.allow_format,'"></td>\n                <td width="1%"><a href="#" class="rtcl-remove-download">Delete</a></td>\n            </tr>');e("#rtcl-marketplace-download").append(l)})),e(document).on("click",".rtcl-remove-download",(function(){return confirm("Do you want to delete this item?")&&e(this).closest("tr").fadeOut(500,(function(){e(this).remove()})),!1})),e("body").on("blur",".rtcl-marketplace-downloadable-meta input.file_url",(function(){var t=e(this).closest("tr").find(".file_name input");""===t.val()?(e(this).closest("tr").addClass("empty-field"),t.focus()):e(this).closest("tr").removeClass("empty-field")})),e("body").on("change",".file_name input",(function(){e(this).val()&&e(this).closest("tr").removeClass("empty-field")})),t("#_rtcl_enable_download",".rtcl-download-file-wrapper"),t("#_rtcl_manage_stock",".rtcl-marketplace-wrap"),e(document).on("click",".upload_file_button",(function(t){t.preventDefault();var l=e(this).closest("tr").find("td.file_url input"),a=wp.media({title:"Choose File",button:{text:"Insert File"},multiple:!1});return a.on("select",(function(){var e=a.state().get("selection").first().toJSON(),t=e.filesizeInBytes;if(t>(1024*rtclMarketPlace.max_file_size||1048576))return alert("Your file size is ".concat(Math.ceil(t/1024)," KB, which exceeds the maximum upload limit of ").concat(rtclMarketPlace.max_file_size," KB.")),a.open(),!1;var n=e.url;l.val(n).trigger("change")})),a.open(),!1})),e(document).on("change",".upload-file-button",(function(){var t=e(this)[0].files[0],l=e(this).closest("tr"),a=t.size;if(a>(1024*rtclMarketPlace.max_file_size||1048576))return alert("Your file size is ".concat(Math.ceil(a/1024)," KB, which exceeds the maximum upload limit of ").concat(rtclMarketPlace.max_file_size," KB.")),!1;var n=new FileReader;n.onload=function(a){var n=a.target.result,i=window.btoa(n);e.ajax({url:rtclMarketPlace.ajaxurl,type:"POST",data:{action:"handle_ajax_file_upload",nonce:rtclMarketPlace.nonce,file:i,filename:t.name,filetype:t.type},beforeSend:function(){l.addClass("loading")},success:function(e){e.success?l.find(".file_url").val(e.data.url):alert("File upload failed: "+e.data.error),l.removeClass("loading")},error:function(e,t,a){alert("An error occurred: "+a),l.removeClass("loading")}})},n.readAsBinaryString(t)}))}))}(jQuery);
